/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */
(function(a,b){if(typeof exports==="object"&&exports){module.exports=b}else{if(typeof define==="function"&&define.amd){define(b)}else{a.Mustache=b}}}(this,(function(){var t={};t.name="mustache.js";t.version="0.7.2";t.tags=["{{","}}"];t.Scanner=s;t.Context=q;t.Writer=n;var d=/\s*/;var j=/\s+/;var h=/\S/;var g=/\s*=/;var l=/\s*\}/;var r=/#|\^|\/|>|\{|&|=|!/;function m(w,v){return RegExp.prototype.test.call(w,v)}function f(v){return !m(h,v)}var i=Array.isArray||function(v){return Object.prototype.toString.call(v)==="[object Array]"};function e(v){return v.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function k(v){return String(v).replace(/[&<>"'\/]/g,function(w){return c[w]})}t.escape=k;function s(v){this.string=v;this.tail=v;this.pos=0}s.prototype.eos=function(){return this.tail===""};s.prototype.scan=function(w){var v=this.tail.match(w);if(v&&v.index===0){this.tail=this.tail.substring(v[0].length);this.pos+=v[0].length;return v[0]}return""};s.prototype.scanUntil=function(w){var v,x=this.tail.search(w);switch(x){case -1:v=this.tail;this.pos+=this.tail.length;this.tail="";break;case 0:v="";break;default:v=this.tail.substring(0,x);this.tail=this.tail.substring(x);this.pos+=x}return v};function q(v,w){this.view=v;this.parent=w;this._cache={}}q.make=function(v){return(v instanceof q)?v:new q(v)};q.prototype.push=function(v){return new q(v,this)};q.prototype.lookup=function(v){var y=this._cache[v];if(!y){if(v=="."){y=this.view}else{var x=this;while(x){if(v.indexOf(".")>0){y=x.view;var z=v.split("."),w=0;while(y&&w<z.length){y=y[z[w++]]}}else{y=x.view[v]}if(y!=null){break}x=x.parent}}this._cache[v]=y}if(typeof y==="function"){y=y.call(this.view)}return y};function n(){this.clearCache()}n.prototype.clearCache=function(){this._cache={};this._partialCache={}};n.prototype.compile=function(x,v){var w=this._cache[x];if(!w){var y=t.parse(x,v);w=this._cache[x]=this.compileTokens(y,x)}return w};n.prototype.compilePartial=function(w,y,v){var x=this.compile(y,v);this._partialCache[w]=x;return x};n.prototype.getPartial=function(v){if(!(v in this._partialCache)&&this._loadPartial){this.compilePartial(v,this._loadPartial(v))}return this._partialCache[v]};n.prototype.compileTokens=function(x,w){var v=this;return function(y,A){if(A){if(typeof A==="function"){v._loadPartial=A}else{for(var z in A){v.compilePartial(z,A[z])}}}return o(x,v,q.make(y),w)}};n.prototype.render=function(x,v,w){return this.compile(x)(v,w)};function o(C,w,v,F){var z="";var x,D,E;for(var A=0,B=C.length;A<B;++A){x=C[A];D=x[1];switch(x[0]){case"#":E=v.lookup(D);if(typeof E==="object"){if(i(E)){for(var y=0,H=E.length;y<H;++y){z+=o(x[4],w,v.push(E[y]),F)}}else{if(E){z+=o(x[4],w,v.push(E),F)}}}else{if(typeof E==="function"){var G=F==null?null:F.slice(x[3],x[5]);E=E.call(v.view,G,function(I){return w.render(I,v)});if(E!=null){z+=E}}else{if(E){z+=o(x[4],w,v,F)}}}break;case"^":E=v.lookup(D);if(!E||(i(E)&&E.length===0)){z+=o(x[4],w,v,F)}break;case">":E=w.getPartial(D);if(typeof E==="function"){z+=E(v)}break;case"&":E=v.lookup(D);if(E!=null){z+=E}break;case"name":E=v.lookup(D);if(E!=null){z+=t.escape(E)}break;case"text":z+=D;break}}return z}function u(B){var w=[];var A=w;var C=[];var y;for(var x=0,v=B.length;x<v;++x){y=B[x];switch(y[0]){case"#":case"^":C.push(y);A.push(y);A=y[4]=[];break;case"/":var z=C.pop();z[5]=y[2];A=C.length>0?C[C.length-1][4]:w;break;default:A.push(y)}}return w}function a(A){var x=[];var z,w;for(var y=0,v=A.length;y<v;++y){z=A[y];if(z){if(z[0]==="text"&&w&&w[0]==="text"){w[1]+=z[1];w[3]=z[3]}else{w=z;x.push(z)}}}return x}function p(v){return[new RegExp(e(v[0])+"\\s*"),new RegExp("\\s*"+e(v[1]))]}t.parse=function(L,B){L=L||"";B=B||t.tags;if(typeof B==="string"){B=B.split(j)}if(B.length!==2){throw new Error("Invalid tags: "+B.join(", "))}var F=p(B);var x=new s(L);var D=[];var C=[];var A=[];var M=false;var K=false;function J(){if(M&&!K){while(A.length){delete C[A.pop()]}}else{A=[]}M=false;K=false}var y,w,E,G,z;while(!x.eos()){y=x.pos;E=x.scanUntil(F[0]);if(E){for(var H=0,I=E.length;H<I;++H){G=E.charAt(H);if(f(G)){A.push(C.length)}else{K=true}C.push(["text",G,y,y+1]);y+=1;if(G=="\n"){J()}}}if(!x.scan(F[0])){break}M=true;w=x.scan(r)||"name";x.scan(d);if(w==="="){E=x.scanUntil(g);x.scan(g);x.scanUntil(F[1])}else{if(w==="{"){E=x.scanUntil(new RegExp("\\s*"+e("}"+B[1])));x.scan(l);x.scanUntil(F[1]);w="&"}else{E=x.scanUntil(F[1])}}if(!x.scan(F[1])){throw new Error("Unclosed tag at "+x.pos)}z=[w,E,y,x.pos];C.push(z);if(w==="#"||w==="^"){D.push(z)}else{if(w==="/"){if(D.length===0){throw new Error('Unopened section "'+E+'" at '+y)}var v=D.pop();if(v[1]!==E){throw new Error('Unclosed section "'+v[1]+'" at '+y)}}else{if(w==="name"||w==="{"||w==="&"){K=true}else{if(w==="="){B=E.split(j);if(B.length!==2){throw new Error("Invalid tags at "+y+": "+B.join(", "))}F=p(B)}}}}}var v=D.pop();if(v){throw new Error('Unclosed section "'+v[1]+'" at '+x.pos)}C=a(C);return u(C)};var b=new n();t.clearCache=function(){return b.clearCache()};t.compile=function(w,v){return b.compile(w,v)};t.compilePartial=function(w,x,v){return b.compilePartial(w,x,v)};t.compileTokens=function(w,v){return b.compileTokens(w,v)};t.render=function(x,v,w){return b.render(x,v,w)};t.to_html=function(y,w,x,z){var v=t.render(y,w,x);if(typeof z==="function"){z(v)}else{return v}};return t}())));
